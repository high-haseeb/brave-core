{"version":3,"sources":["../src/index.ts"],"names":["BigNumber","validateAddressString","set","ROUNDING_MODE","ROUND_HALF_DOWN","config","EXPONENTIAL_AT","Message","_to","_from","_nonce","_method","_value","_gasPremium","_gasFeeCap","_gasLimit","_params","msg","To","to","From","from","Nonce","nonce","Value","value","toFixed","GasPremium","gasPremium","GasFeeCap","gasFeeCap","GasLimit","gasLimit","Method","method","Params","params","gaspremium","gasfeecap","gaslimit","cid","toAddr","robust","id","fromAddr","toString","height","typeCheck","Error","Number","MAX_SAFE_INTEGER"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport { validateAddressString } from '@glif/filecoin-address'\n\nBigNumber.set({ ROUNDING_MODE: BigNumber.ROUND_HALF_DOWN })\nBigNumber.config({ EXPONENTIAL_AT: 1e9 })\n\nexport interface ZondaxMessage {\n  readonly to: string\n  readonly from: string\n  readonly nonce: number\n  readonly value: string\n  readonly gaspremium: string\n  readonly gaslimit: number\n  readonly gasfeecap: string\n  readonly method: number\n  readonly params: string | string[] | undefined\n}\n\nexport type Address = {\n  robust: string\n  id: string\n}\n\nexport type MessagePending = {\n  cid: string\n  from: Address\n  gasFeeCap: string\n  gasLimit: string\n  gasPremium: string\n  height: string\n  method: string\n  nonce: string\n  params: string | string[] | undefined\n  to: Address\n  value: string\n  version?: string\n}\n\ntype SerializableMessage = ZondaxMessage\n\nexport interface LotusMessage {\n  To: string\n  From: string\n  Nonce: number\n  Value: string\n  GasPremium: string\n  GasLimit: number\n  GasFeeCap: string\n  Method: number\n  Params?: string | string[]\n}\n\nexport interface SignedLotusMessage {\n  Message: LotusMessage\n  Signature: {\n    Type: number\n    Data: string\n  }\n}\n\nexport interface MessageObj {\n  to: string\n  from: string\n  nonce: number\n  method: number\n  value: string | number | BigNumber\n  gasPremium?: string | number | BigNumber\n  gasFeeCap?: string | number | BigNumber\n  gasLimit?: number\n  params?: string | string[]\n}\n\nexport class Message {\n  private _to: string\n  private _from: string\n  private _nonce: number\n  private _method: number\n  private _value: BigNumber\n  private _gasPremium: BigNumber\n  private _gasFeeCap: BigNumber\n  private _gasLimit: number\n  private _params: string | string[] | undefined\n\n  public get to(): string {\n    return this._to\n  }\n\n  public get from(): string {\n    return this._from\n  }\n\n  public get nonce(): number {\n    return this._nonce\n  }\n\n  public get method(): number {\n    return this._method\n  }\n\n  public get value(): BigNumber {\n    return this._value\n  }\n\n  public get gasPremium(): BigNumber {\n    return this._gasPremium\n  }\n\n  public get gasFeeCap(): BigNumber {\n    return this._gasFeeCap\n  }\n\n  public get gasLimit(): number {\n    return this._gasLimit\n  }\n\n  public get params(): string | string[] | undefined {\n    return this._params\n  }\n\n  public constructor(msg: MessageObj) {\n    typeCheck(msg)\n    this._to = msg.to\n    this._from = msg.from\n    this._nonce = msg.nonce\n    this._value = new BigNumber(msg.value || 0)\n    this._gasPremium = new BigNumber(msg.gasPremium || 0)\n    this._gasFeeCap = new BigNumber(msg.gasFeeCap || 0)\n    this._gasLimit = msg.gasLimit || 0\n    this._method = msg.method\n    this._params = msg.params\n  }\n\n  static fromZondaxType = ({\n    to,\n    from,\n    nonce,\n    value,\n    gaspremium,\n    gaslimit,\n    gasfeecap,\n    method,\n    params\n  }: ZondaxMessage): Message => {\n    return new Message({\n      to,\n      from,\n      nonce,\n      value,\n      gasPremium: gaspremium,\n      gasLimit: gaslimit,\n      gasFeeCap: gasfeecap,\n      method,\n      params\n    })\n  }\n\n  static fromLotusType = ({\n    To,\n    From,\n    Nonce,\n    Value,\n    GasPremium,\n    GasLimit,\n    GasFeeCap,\n    Method,\n    Params\n  }: LotusMessage): Message => {\n    return new Message({\n      to: To,\n      from: From,\n      nonce: Nonce,\n      value: Value,\n      gasPremium: GasPremium,\n      gasLimit: GasLimit,\n      gasFeeCap: GasFeeCap,\n      method: Method,\n      params: Params\n    })\n  }\n\n  public toLotusType = (): LotusMessage => {\n    return {\n      To: this.to,\n      From: this.from,\n      Nonce: this.nonce,\n      Value: this.value.toFixed(0, 1),\n      GasPremium: this.gasPremium.toFixed(0, 1),\n      GasFeeCap: this.gasFeeCap.toFixed(0, 1),\n      GasLimit: this.gasLimit,\n      Method: this.method,\n      Params: this.params\n    }\n  }\n\n  public toSerializeableType = (): SerializableMessage => {\n    return {\n      to: this.to,\n      from: this.from,\n      nonce: this.nonce,\n      value: this.value.toFixed(0, 1),\n      gaspremium: this.gasPremium.toFixed(0, 1),\n      gasfeecap: this.gasFeeCap.toFixed(0, 1),\n      gaslimit: this.gasLimit,\n      method: this.method,\n      params: this.params\n    }\n  }\n\n  public toZondaxType = (): ZondaxMessage => {\n    return {\n      to: this.to,\n      from: this.from,\n      nonce: this.nonce,\n      value: this.value.toFixed(0, 1),\n      gaspremium: this.gasPremium.toFixed(0, 1),\n      gasfeecap: this.gasFeeCap.toFixed(0, 1),\n      gaslimit: this.gasLimit,\n      method: this.method,\n      params: this.params || ''\n    }\n  }\n\n  public toPendingMessage = (cid: string): MessagePending => {\n    const toAddr: Address = {\n      robust: '',\n      id: ''\n    }\n\n    const fromAddr: Address = {\n      robust: '',\n      id: ''\n    }\n    if (this.to[1] === '0') toAddr.id = this.to\n    else toAddr.robust = this.to\n\n    if (this.from[1] === '0') fromAddr.id = this.from\n    else fromAddr.robust = this.from\n    return {\n      to: toAddr,\n      from: fromAddr,\n      cid,\n      method: this.method.toString(),\n      gasFeeCap: this.gasFeeCap.toString(),\n      gasLimit: this.gasLimit.toString(),\n      gasPremium: this.gasPremium.toString(),\n      params: this.params || '',\n      height: '',\n      value: this.value.toString(),\n      nonce: this.nonce.toString()\n    }\n  }\n}\n\nconst typeCheck = (msg: MessageObj): void => {\n  if (!msg.to) throw new Error('No to address provided')\n  if (!msg.from) throw new Error('No from address provided')\n\n  if (!validateAddressString(msg.to))\n    throw new Error('Invalid to address provided')\n  if (!validateAddressString(msg.from))\n    throw new Error('Invalid from address provided')\n\n  if (!msg.nonce && msg.nonce !== 0) throw new Error('No nonce provided')\n  if (typeof msg.nonce !== 'number') throw new Error('Nonce is not a number')\n  if (!(msg.nonce <= Number.MAX_SAFE_INTEGER))\n    throw new Error('Nonce must be smaller than Number.MAX_SAFE_INTEGER')\n\n  if (!msg.value) throw new Error('No value provided')\n\n  if (msg.gasLimit && typeof msg.gasLimit !== 'number')\n    throw new Error('Gas limit is not a number')\n  if (msg.gasLimit && !(msg.gasLimit <= Number.MAX_SAFE_INTEGER))\n    throw new Error('Gas limit must be smaller than Number.MAX_SAFE_INTEGER')\n\n  if (!msg.method && msg.method !== 0) throw new Error('No method provided')\n  if (typeof msg.method !== 'number') throw new Error('Method is not a number')\n  if (!(msg.method <= Number.MAX_SAFE_INTEGER))\n    throw new Error('Method must be smaller than Number.MAX_SAFE_INTEGER')\n}\n\nexport default {\n  Message\n}\n"],"file":"index.js"}